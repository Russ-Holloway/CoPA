# Fix for Deployment Template Error - Missing SubscriptionId

This document provides a solution for the "InvalidTemplate" error when using the "Deploy to Azure" button:

```
{
  "code": "InvalidTemplate",
  "message": "Deployment template validation failed: 'The value for the template parameter 'SubscriptionId' at line '5' and column '27' is not provided. Please see https://aka.ms/arm-create-parameter-file for usage details.'."
}
```

## Root Cause

The ARM template (`deployment.json`) requires a `SubscriptionId` parameter, but this parameter isn't being correctly passed when deploying through the "Deploy to Azure" button.

## Solution

I've modified the deployment files to fix this issue:

1. Updated `deployment.json` to use the current subscription ID automatically using the `subscription()` function instead of requiring it as a parameter.

2. Removed the dependency on the `SubscriptionId` parameter in `createUiDefinition.json`.

## Steps to Apply the Fix

### Option 1: Use the PowerShell Script

1. Open PowerShell as administrator
2. Navigate to the repository directory
3. Run the newly created script:
   ```powershell
   .\update_template.ps1
   ```
4. Follow the on-screen prompts
5. Update your README.md's "Deploy to Azure" button with the new URL generated by the script

### Option 2: Manual Update

If you prefer to update your Azure Storage manually:

1. Navigate to your Azure Portal
2. Find the storage account where your deployment templates are stored
3. Upload the modified `deployment.json` and `createUiDefinition.json` files
4. Generate new SAS tokens and update the deployment button URL

## Verifying the Fix

After applying the fix:

1. Click the "Deploy to Azure" button
2. Verify that the deployment process begins without the "InvalidTemplate" error
3. Complete the deployment as normal

## For Future Deployments

When creating ARM templates for deployment buttons:
- Avoid relying on subscription-specific parameters that aren't collected in the UI
- Use ARM template functions like `subscription()` to automatically get context-specific values
- Test the deployment process end-to-end before publishing
